<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookmark Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="/public/assets/web_presence/icons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/public/assets/web_presence/icons/favicon.svg" />
    <link rel="shortcut icon" href="/public/assets/web_presence/icons/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/public/assets/web_presence/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Bookmarks" />
    <link rel="manifest" href="/public/assets/web_presence/icons/site.webmanifest" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e4e8;
        }

        h1 {
            color: #2c3e50;
            font-weight: 600;
        }

        .search-container {
            display: flex;
            margin-bottom: 20px;
        }

        .search-container input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            font-size: 16px;
        }

        .search-container button {
            padding: 12px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }

        .main-content {
            display: flex;
            gap: 30px;
        }

        .folders-section {
            flex: 0 0 250px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .folders-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .folders-list {
            list-style: none;
        }

        .folder-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder-item:hover {
            background: #f0f5ff;
        }

        .folder-item.active {
            background: #e1eefd;
            color: #3498db;
            font-weight: 500;
        }

        .bookmarks-section {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .bookmarks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .bookmarks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .bookmark-card {
            background: #f9fafc;
            border-radius: 8px;
            padding: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid #eaeef2;
            cursor: pointer;
            position: relative;
        }

        .bookmark-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .bookmark-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .favicon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            object-fit: contain;
        }

        .bookmark-title {
            font-weight: 500;
            flex: 1;
            word-break: break-word;
        }

        .bookmark-url {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 12px;
            word-break: break-all;
        }

        .bookmark-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            z-index: 2;
            position: relative;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #e1eefd;
            color: #3498db;
        }

        .btn-secondary:hover {
            background: #d0e4fc;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: #64748b;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #cbd5e1;
        }

        .emoji-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
            max-height: 100px;
            overflow-y: auto;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .emoji-option {
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
        }

        .emoji-option:hover {
            background-color: #f0f5ff;
        }

        .import-export {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e1e4e8;
        }

        .bookmark-link {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - 50px);
            z-index: 1;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .folders-section {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-bookmark"></i> Bookmark Manager</h1>
            <button class="btn btn-primary" id="add-bookmark-btn">
                <i class="fas fa-plus"></i> Add Bookmark
            </button>
        </header>

        <div class="search-container">
            <input type="text" id="search-input" placeholder="Search bookmarks...">
            <button id="search-btn"><i class="fas fa-search"></i> Search</button>
        </div>

        <div class="main-content">
            <div class="folders-section">
                <div class="folders-header">
                    <h2>Folders</h2>
                    <button class="btn btn-secondary" id="add-folder-btn">
                        <i class="fas fa-folder-plus"></i>
                    </button>
                </div>
                <ul class="folders-list" id="folders-list">
                    <li class="folder-item active" data-folder="all">
                        <span><i class="fas fa-globe"></i> All Bookmarks</span>
                        <span class="count">0</span>
                    </li>
                </ul>
                <div class="import-export">
                    <button class="btn btn-secondary" id="import-btn" style="width: 100%; margin-bottom: 10px;">
                        <i class="fas fa-file-import"></i> Import
                    </button>
                    <button class="btn btn-secondary" id="export-btn" style="width: 100%;">
                        <i class="fas fa-file-export"></i> Export
                    </button>
                </div>
            </div>

            <div class="bookmarks-section">
                <div class="bookmarks-header">
                    <h2 id="current-folder">All Bookmarks</h2>
                    <div>
                        <span id="bookmarks-count">0 bookmarks</span>
                    </div>
                </div>
                <div class="bookmarks-grid" id="bookmarks-grid">
                    <!-- Bookmark cards will be generated here -->
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <h3>No bookmarks yet</h3>
                        <p>Add your first bookmark to get started</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Bookmark Modal -->
    <div class="modal" id="add-bookmark-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Bookmark</h2>
                <span class="close">&times;</span>
            </div>
            <form id="add-bookmark-form">
                <div class="form-group">
                    <label for="bookmark-title">Title</label>
                    <input type="text" id="bookmark-title" required placeholder="Enter bookmark title">
                </div>
                <div class="form-group">
                    <label for="bookmark-url">URL</label>
                    <input type="url" id="bookmark-url" required placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label for="bookmark-folder">Folder</label>
                    <select id="bookmark-folder">
                        <!-- Folders will be populated dynamically -->
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Save Bookmark</button>
            </form>
        </div>
    </div>

    <!-- Add Folder Modal -->
    <div class="modal" id="add-folder-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Folder</h2>
                <span class="close">&times;</span>
            </div>
            <form id="add-folder-form">
                <div class="form-group">
                    <label for="folder-name">Folder Name</label>
                    <input type="text" id="folder-name" required placeholder="Enter folder name">
                </div>
                <div class="form-group">
                    <label for="folder-icon">Folder Icon</label>
                    <input type="text" id="folder-icon" placeholder="Select an icon below">
                    <div class="emoji-picker" id="emoji-picker">
                        <span class="emoji-option">📁</span>
                        <span class="emoji-option">💼</span>
                        <span class="emoji-option">🎓</span>
                        <span class="emoji-option">🎬</span>
                        <span class="emoji-option">❤️</span>
                        <span class="emoji-option">⭐</span>
                        <span class="emoji-option">🏠</span>
                        <span class="emoji-option">🚀</span>
                        <span class="emoji-option">📚</span>
                        <span class="emoji-option">🎵</span>
                        <span class="emoji-option">🎮</span>
                        <span class="emoji-option">🍔</span>
                        <span class="emoji-option">📝</span>
                        <span class="emoji-option">🧑‍💻</span>
                        <span class="emoji-option">🐶</span>
                        <span class="emoji-option">🛒</span>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Create Folder</button>
            </form>
        </div>
    </div>

    <!-- Edit Bookmark Modal -->
    <div class="modal" id="edit-bookmark-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Bookmark</h2>
                <span class="close">&times;</span>
            </div>
            <form id="edit-bookmark-form">
                <input type="hidden" id="edit-bookmark-id">
                <div class="form-group">
                    <label for="edit-bookmark-title">Title</label>
                    <input type="text" id="edit-bookmark-title" required>
                </div>
                <div class="form-group">
                    <label for="edit-bookmark-url">URL</label>
                    <input type="url" id="edit-bookmark-url" required>
                </div>
                <div class="form-group">
                    <label for="edit-bookmark-folder">Folder</label>
                    <select id="edit-bookmark-folder">
                        <!-- Folders will be populated dynamically -->
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Import Bookmarks</h2>
                <span class="close">&times;</span>
            </div>
            <div class="form-group">
                <label for="import-type">Import From</label>
                <select id="import-type">
                    <option value="json">JSON File</option>
                    <option value="html">Browser Bookmarks (HTML)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="import-file">Select File</label>
                <input type="file" id="import-file" accept=".json,.html">
            </div>
            <div class="form-group">
                <button class="btn btn-primary" id="import-process-btn">Import</button>
            </div>
        </div>
    </div>

    <script>
        // Data structure
        let bookmarksData = [];
        let foldersData = [];

        // DOM Elements
        const bookmarksGrid = document.getElementById('bookmarks-grid');
        const foldersList = document.getElementById('folders-list');
        const currentFolderElement = document.getElementById('current-folder');
        const bookmarksCountElement = document.getElementById('bookmarks-count');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const folderSelect = document.getElementById('bookmark-folder');
        const editFolderSelect = document.getElementById('edit-bookmark-folder');

        // Modal elements
        const addBookmarkModal = document.getElementById('add-bookmark-modal');
        const addFolderModal = document.getElementById('add-folder-modal');
        const editBookmarkModal = document.getElementById('edit-bookmark-modal');
        const importModal = document.getElementById('import-modal');
        const closeButtons = document.querySelectorAll('.close');

        // Form elements
        const addBookmarkForm = document.getElementById('add-bookmark-form');
        const addFolderForm = document.getElementById('add-folder-form');
        const editBookmarkForm = document.getElementById('edit-bookmark-form');

        // Button elements
        const addBookmarkBtn = document.getElementById('add-bookmark-btn');
        const addFolderBtn = document.getElementById('add-folder-btn');
        const importBtn = document.getElementById('import-btn');
        const exportBtn = document.getElementById('export-btn');
        const importProcessBtn = document.getElementById('import-process-btn');

        // Current state
        let currentFolder = 'all';

        // Initialize the app
        function init() {
            loadData();
            renderFolders();
            renderBookmarks();
            setupEventListeners();
        }

        // Load data from localStorage
        function loadData() {
            const savedBookmarks = localStorage.getItem('bookmarks');
            const savedFolders = localStorage.getItem('folders');
            
            if (savedBookmarks) {
                bookmarksData = JSON.parse(savedBookmarks);
            }
            
            if (savedFolders) {
                foldersData = JSON.parse(savedFolders);
            } else {
                // Add default folders if none exist
                foldersData = [
                    { id: 'work', name: 'Work', icon: '💼' },
                    { id: 'education', name: 'Education', icon: '🎓' },
                    { id: 'entertainment', name: 'Entertainment', icon: '🎬' },
                    { id: 'personal', name: 'Personal', icon: '🧑' }
                ];
                saveData();
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('bookmarks', JSON.stringify(bookmarksData));
            localStorage.setItem('folders', JSON.stringify(foldersData));
        }

        // Render folders in the sidebar and selects
        function renderFolders() {
            // Clear existing folders except "All Bookmarks"
            const folderItems = foldersList.querySelectorAll('.folder-item:not([data-folder="all"])');
            folderItems.forEach(item => item.remove());
            
            // Clear select options
            folderSelect.innerHTML = '';
            editFolderSelect.innerHTML = '';
            
            // Add folders to sidebar
            foldersData.forEach(folder => {
                const folderItem = document.createElement('li');
                folderItem.className = 'folder-item';
                folderItem.dataset.folder = folder.id;
                folderItem.innerHTML = `
                    <span>${folder.icon} ${folder.name}</span>
                    <span class="count">${bookmarksData.filter(b => b.folder === folder.id).length}</span>
                `;
                foldersList.appendChild(folderItem);
                
                // Add to select options
                const option = document.createElement('option');
                option.value = folder.id;
                option.textContent = folder.name;
                folderSelect.appendChild(option);
                
                const editOption = option.cloneNode(true);
                editFolderSelect.appendChild(editOption);
            });
        }

        // Render bookmarks based on current folder and search
        function renderBookmarks() {
            let filteredBookmarks = [...bookmarksData];
            
            // Filter by folder
            if (currentFolder !== 'all') {
                filteredBookmarks = filteredBookmarks.filter(bookmark => bookmark.folder === currentFolder);
            }
            
            // Filter by search term
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filteredBookmarks = filteredBookmarks.filter(bookmark => 
                    bookmark.title.toLowerCase().includes(searchTerm) || 
                    bookmark.url.toLowerCase().includes(searchTerm)
                );
            }
            
            // Update count
            bookmarksCountElement.textContent = `${filteredBookmarks.length} bookmarks`;
            
            // Clear grid
            bookmarksGrid.innerHTML = '';
            
            // Show empty state if no bookmarks
            if (filteredBookmarks.length === 0) {
                bookmarksGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <h3>No bookmarks found</h3>
                        <p>Try a different search or add a new bookmark</p>
                    </div>
                `;
                return;
            }
            
            // Render bookmarks
            filteredBookmarks.forEach(bookmark => {
                const bookmarkElement = document.createElement('div');
                bookmarkElement.className = 'bookmark-card';
                bookmarkElement.innerHTML = `
                    <a href="${bookmark.url}" target="_blank" class="bookmark-link"></a>
                    <div class="bookmark-header">
                        <img src="${bookmark.favicon}" alt="Favicon" class="favicon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzM0OThkYiI+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgMThjLTQuNDIgMC04LTMuNTgtOC04czMuNTgtOCA4LTggOCAzLjU4IDggOC0zLjU4IDgtOCA4eiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4='">
                        <div class="bookmark-title">${bookmark.title}</div>
                    </div>
                    <div class="bookmark-url">${bookmark.url}</div>
                    <div class="bookmark-actions">
                        <button class="btn btn-secondary edit-btn" data-id="${bookmark.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-secondary delete-btn" data-id="${bookmark.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                bookmarksGrid.appendChild(bookmarkElement);
            });
            
            // Update folder counts
            updateFolderCounts();
        }

        // Update the count of bookmarks in each folder
        function updateFolderCounts() {
            const folderItems = foldersList.querySelectorAll('.folder-item');
            folderItems.forEach(item => {
                const folder = item.dataset.folder;
                if (folder === 'all') {
                    item.querySelector('.count').textContent = bookmarksData.length;
                } else {
                    const count = bookmarksData.filter(b => b.folder === folder).length;
                    item.querySelector('.count').textContent = count;
                }
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Folder selection
            foldersList.addEventListener('click', (e) => {
                const folderItem = e.target.closest('.folder-item');
                if (folderItem) {
                    // Update active state
                    foldersList.querySelectorAll('.folder-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    folderItem.classList.add('active');
                    
                    // Update current folder and render
                    currentFolder = folderItem.dataset.folder;
                    const folderName = folderItem.dataset.folder === 'all' 
                        ? 'All Bookmarks' 
                        : foldersData.find(f => f.id === folderItem.dataset.folder)?.name || 'All Bookmarks';
                    currentFolderElement.textContent = folderName;
                    renderBookmarks();
                }
            });
            
            // Search functionality
            searchBtn.addEventListener('click', renderBookmarks);
            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    renderBookmarks();
                }
            });
            
            // Open modals
            addBookmarkBtn.addEventListener('click', () => {
                addBookmarkModal.style.display = 'flex';
            });
            
            addFolderBtn.addEventListener('click', () => {
                addFolderModal.style.display = 'flex';
            });
            
            importBtn.addEventListener('click', () => {
                importModal.style.display = 'flex';
            });
            
            exportBtn.addEventListener('click', exportBookmarks);
            
            // Close modals
            closeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    addBookmarkModal.style.display = 'none';
                    addFolderModal.style.display = 'none';
                    editBookmarkModal.style.display = 'none';
                    importModal.style.display = 'none';
                });
            });
            
            // Click outside modal to close
            window.addEventListener('click', (e) => {
                if (e.target === addBookmarkModal) addBookmarkModal.style.display = 'none';
                if (e.target === addFolderModal) addFolderModal.style.display = 'none';
                if (e.target === editBookmarkModal) editBookmarkModal.style.display = 'none';
                if (e.target === importModal) importModal.style.display = 'none';
            });
            
            // Emoji picker
            const emojiOptions = document.querySelectorAll('.emoji-option');
            emojiOptions.forEach(emoji => {
                emoji.addEventListener('click', () => {
                    document.getElementById('folder-icon').value = emoji.textContent;
                });
            });
            
            // Form submissions
            addBookmarkForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const title = document.getElementById('bookmark-title').value;
                const url = document.getElementById('bookmark-url').value;
                const folder = document.getElementById('bookmark-folder').value;
                
                // Generate a favicon URL
                let favicon = '';
                try {
                    const domain = new URL(url).hostname;
                    favicon = `https://www.google.com/s2/favicons?domain=${domain}`;
                } catch (e) {
                    favicon = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzM0OThkYiI+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgMThjLTQuNDIgMC04LTMuNTgtOC04czMuNTgtOCA4LTggOCAzLjU4IDggOC0zLjU4IDgtOCA4eiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=';
                }
                
                // Create new bookmark
                const newBookmark = {
                    id: Date.now(), // Simple ID generation
                    title,
                    url,
                    folder,
                    favicon
                };
                
                bookmarksData.push(newBookmark);
                saveData();
                renderBookmarks();
                renderFolders();
                
                // Reset form and close modal
                addBookmarkForm.reset();
                addBookmarkModal.style.display = 'none';
            });
            
            addFolderForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const folderName = document.getElementById('folder-name').value;
                const folderIcon = document.getElementById('folder-icon').value || '📁';
                const folderId = folderName.toLowerCase().replace(/\s+/g, '-');
                
                // Check if folder already exists
                if (foldersData.some(f => f.id === folderId)) {
                    alert('A folder with this name already exists');
                    return;
                }
                
                // Add new folder
                foldersData.push({
                    id: folderId,
                    name: folderName,
                    icon: folderIcon
                });
                
                saveData();
                renderFolders();
                
                // Reset form and close modal
                addFolderForm.reset();
                addFolderModal.style.display = 'none';
            });
            
            // Edit and delete bookmarks
            bookmarksGrid.addEventListener('click', (e) => {
                // Prevent the click from opening the bookmark link
                if (e.target.closest('.edit-btn') || e.target.closest('.delete-btn')) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                // Edit button
                if (e.target.closest('.edit-btn')) {
                    const id = parseInt(e.target.closest('.edit-btn').dataset.id);
                    const bookmark = bookmarksData.find(b => b.id === id);
                    
                    if (bookmark) {
                        document.getElementById('edit-bookmark-id').value = bookmark.id;
                        document.getElementById('edit-bookmark-title').value = bookmark.title;
                        document.getElementById('edit-bookmark-url').value = bookmark.url;
                        document.getElementById('edit-bookmark-folder').value = bookmark.folder;
                        
                        editBookmarkModal.style.display = 'flex';
                    }
                }
                
                // Delete button
                if (e.target.closest('.delete-btn')) {
                    const id = parseInt(e.target.closest('.delete-btn').dataset.id);
                    if (confirm('Are you sure you want to delete this bookmark?')) {
                        bookmarksData = bookmarksData.filter(b => b.id !== id);
                        saveData();
                        renderBookmarks();
                        renderFolders();
                    }
                }
            });
            
            // Edit form submission
            editBookmarkForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = parseInt(document.getElementById('edit-bookmark-id').value);
                const title = document.getElementById('edit-bookmark-title').value;
                const url = document.getElementById('edit-bookmark-url').value;
                const folder = document.getElementById('edit-bookmark-folder').value;
                
                // Update bookmark
                const index = bookmarksData.findIndex(b => b.id === id);
                if (index !== -1) {
                    bookmarksData[index].title = title;
                    bookmarksData[index].url = url;
                    bookmarksData[index].folder = folder;
                    
                    // Update favicon if URL changed
                    if (bookmarksData[index].url !== url) {
                        try {
                            const domain = new URL(url).hostname;
                            bookmarksData[index].favicon = `https://www.google.com/s2/favicons?domain=${domain}`;
                        } catch (e) {
                            // Keep existing favicon if URL is invalid
                        }
                    }
                    
                    saveData();
                    renderBookmarks();
                    renderFolders();
                    editBookmarkModal.style.display = 'none';
                }
            });
            
            // Import functionality
            importProcessBtn.addEventListener('click', () => {
                const importType = document.getElementById('import-type').value;
                const fileInput = document.getElementById('import-file');
                
                if (fileInput.files.length === 0) {
                    alert('Please select a file to import');
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        if (importType === 'json') {
                            const importedData = JSON.parse(e.target.result);
                            
                            if (importedData.bookmarks && Array.isArray(importedData.bookmarks)) {
                                bookmarksData = [...bookmarksData, ...importedData.bookmarks];
                            }
                            
                            if (importedData.folders && Array.isArray(importedData.folders)) {
                                // Merge folders, avoiding duplicates
                                importedData.folders.forEach(newFolder => {
                                    if (!foldersData.some(f => f.id === newFolder.id)) {
                                        foldersData.push(newFolder);
                                    }
                                });
                            }
                        } else if (importType === 'html') {
                            // Basic HTML bookmark import (like browser exports)
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(e.target.result, 'text/html');
                            const links = doc.querySelectorAll('a');
                            
                            links.forEach(link => {
                                const href = link.getAttribute('href');
                                const title = link.textContent;
                                const addDate = link.getAttribute('add_date');
                                const folders = link.closest('dl') ? 
                                    Array.from(link.closest('dl').querySelectorAll('h3'))
                                        .map(h3 => h3.textContent) : [];
                                
                                if (href && href.startsWith('http')) {
                                    // Create a folder if needed
                                    let folderId = 'imported';
                                    if (folders.length > 0) {
                                        folderId = folders[0].toLowerCase().replace(/\s+/g, '-');
                                        if (!foldersData.some(f => f.id === folderId)) {
                                            foldersData.push({
                                                id: folderId,
                                                name: folders[0],
                                                icon: '📁'
                                            });
                                        }
                                    }
                                    
                                    // Generate favicon
                                    let favicon = '';
                                    try {
                                        const domain = new URL(href).hostname;
                                        favicon = `https://www.google.com/s2/favicons?domain=${domain}`;
                                    } catch (err) {
                                        favicon = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzM0OThkYiI+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgMThjLTQuNDIgMC04LTMuNTgtOC04czMuNTgtOCA4LTggOCAzLjU4IDggOC0zLjU4IDgtOCA4eiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=';
                                    }
                                    
                                    // Add bookmark
                                    bookmarksData.push({
                                        id: Date.now() + Math.floor(Math.random() * 1000),
                                        title: title || href,
                                        url: href,
                                        folder: folderId,
                                        favicon,
                                        addDate: addDate ? parseInt(addDate) * 1000 : Date.now()
                                    });
                                }
                            });
                        }
                        
                        saveData();
                        renderBookmarks();
                        renderFolders();
                        importModal.style.display = 'none';
                        alert('Import completed successfully!');
                    } catch (error) {
                        console.error('Import error:', error);
                        alert('Error importing data. Please check the file format.');
                    }
                };
                
                reader.readAsText(file);
            });
        }

        // Export bookmarks to JSON file
        function exportBookmarks() {
            const data = {
                bookmarks: bookmarksData,
                folders: foldersData,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'bookmarks.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
